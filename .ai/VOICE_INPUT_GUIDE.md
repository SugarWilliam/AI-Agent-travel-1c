# 语音输入功能说明

## 功能概述

AI助手现在支持语音输入功能，用户可以通过语音与AI助手进行对话，无需手动输入文字。

## 支持的输入类型

1. **文本输入** - 手动输入文字
2. **图片输入** - 上传图片进行识别
3. **文档输入** - 上传文档进行解析
4. **语音输入** - 通过语音输入文字（新增）

## 语音输入功能特性

### 1. 实时语音识别
- 使用浏览器原生的 Web Speech API
- 实时将语音转换为文字
- 支持连续语音输入

### 2. 中文语音识别
- 默认使用中文（zh-CN）语音识别
- 支持普通话识别
- 识别准确度高

### 3. 录音状态指示
- **未录音状态**：显示麦克风图标（灰色）
- **录音中状态**：显示麦克风图标（红色，带脉冲动画）
- **停止录音**：点击麦克风图标停止录音

### 4. 错误处理
- 自动检测浏览器是否支持语音识别
- 麦克风权限被拒绝时显示友好提示
- 识别错误时自动停止录音并提示用户

## 使用方法

### 开始录音

1. 点击输入框上方的麦克风图标
2. 浏览器会请求麦克风权限，点击"允许"
3. 开始说话，语音会实时转换为文字显示在输入框中

### 停止录音

- 再次点击麦克风图标停止录音
- 录音会自动停止（静音一段时间后）

### 发送消息

- 录音完成后，点击发送按钮或按 Enter 键发送消息
- 可以在语音输入后继续手动编辑文字

## 技术实现

### 使用的 API

```javascript
// Web Speech API
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
```

### 配置参数

```javascript
recognition.continuous = true;  // 连续识别
recognition.interimResults = true;  // 返回临时结果
recognition.lang = 'zh-CN';  // 中文识别
```

### 事件处理

- `onresult` - 接收识别结果
- `onerror` - 处理识别错误
- `onend` - 录音结束事件

## 浏览器兼容性

### 支持的浏览器

- ✅ Chrome（推荐）
- ✅ Edge
- ✅ Safari（部分支持）
- ❌ Firefox（不支持）

### 注意事项

1. 需要在 HTTPS 环境下使用（本地开发除外）
2. 需要用户授权麦克风权限
3. 需要网络连接（语音识别需要云端服务）

## 数据模型

### ai_multimodal_inputs 表

新增字段：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| inputType | String | 输入类型：text/image/document/voice |
| voiceDuration | Number | 语音时长（秒） |

### 示例数据

```json
{
  "conversationId": "conv_001",
  "messageId": "msg_001",
  "inputType": "voice",
  "content": "帮我规划一下去大理的行程",
  "voiceDuration": 3.5,
  "status": "processed",
  "analysisResult": {
    "intent": "travel_planning",
    "destination": "Dali",
    "confidence": 0.98
  }
}
```

## UI 设计

### 麦克风按钮

- **位置**：输入框上方，图片和文档上传按钮旁边
- **样式**：圆角矩形，与其他按钮保持一致
- **颜色**：
  - 未录音：灰色背景（bg-gray-100）
  - 录音中：红色背景（bg-red-100）
- **图标**：
  - 未录音：Mic 图标（灰色）
  - 录音中：MicOff 图标（红色，带脉冲动画）

### 占位符文本

更新为：
```
输入你的旅行问题，或上传图片/文档，或使用语音输入...
```

### 提示文本

更新为：
```
支持文本、图片、文档、语音输入 • 按Enter发送，Shift+Enter换行
```

## 未来扩展

### 可能的改进

1. **多语言支持** - 支持英文、日文等其他语言
2. **语音播放** - AI回复支持语音播放
3. **语音指令** - 支持语音控制（如"停止"、"重新生成"）
4. **离线识别** - 支持离线语音识别
5. **方言识别** - 支持方言识别（如粤语、四川话等）

### 技术优化

1. 使用更先进的语音识别引擎
2. 添加语音识别结果的可视化波形
3. 支持语音输入的编辑和修正
4. 添加语音识别的置信度显示

## 常见问题

### Q: 为什么无法使用语音输入？

A: 请检查以下几点：
1. 浏览器是否支持（推荐使用 Chrome）
2. 是否允许了麦克风权限
3. 是否在 HTTPS 环境下（本地开发除外）
4. 是否有网络连接

### Q: 语音识别不准确怎么办？

A: 可以尝试：
1. 在安静的环境中使用
2. 说话清晰、语速适中
3. 靠近麦克风
4. 识别后可以手动编辑文字

### Q: 录音会自动停止吗？

A: 会。如果长时间静音，录音会自动停止。也可以手动点击麦克风图标停止录音。

## 总结

语音输入功能为用户提供了更便捷的交互方式，特别适合移动端使用。通过浏览器原生的 Web Speech API，实现了实时、准确的语音识别，大大提升了用户体验。
